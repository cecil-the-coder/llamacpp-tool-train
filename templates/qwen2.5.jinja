{#
  Qwen 2.5 native tool calling template.
#}
{% set loop_messages = messages %}

{%- if tools %}
{{- "<|im_start|>system\nYou are Qwen, created by Alibaba Cloud. You are a helpful assistant.\n\n# Tools\n\nYou may call one or more functions to assist with the user query.\nYou are provided with function descriptions in <tools></tools> XML tags:\n<tools>\n" }}
{%- for tool in tools %}
{{- tool | tojson(indent=2) }}
{{- "\n" }}
{%- endfor %}
{{- "</tools>\n\nFor each function call, output the function name and arguments in the following format:\n<tool_call={\"name\": \"function_name\", \"arguments\": {\"arg\": \"value\"}}>\n\nAfter receiving the results back from a function call, you can continue making decisions or call more functions.<|im_end|>\n" }}
{%- else %}
{{- "<|im_start|>system\nYou are Qwen, created by Alibaba Cloud. You are a helpful assistant.<|im_end|>\n" }}
{%- endif %}

{%- for message in loop_messages %}
{%- if message['role'] == 'user' %}
{{- "<|im_start|>user\n" + message['content'] + "<|im_end|>\n" }}
{%- elif message['role'] == 'assistant' %}
{{- "<|im_start|>assistant\n" + message['content'] + "<|im_end|>\n" }}
{%- elif message['role'] == 'tool' %}
{{- "<|im_start|>tool\n" + message['content'] + "<|im_end|>\n" }}
{%- endif %}
{%- endfor %}

{%- if add_generation_prompt %}
{{- "<|im_start|>assistant\n" }}
{%- endif %}
